<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aura | El Sistema Completo</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;500;800&display=swap');
        :root { --bg: #000; --accent: #00ffd5; --glass: rgba(15,15,15,0.98); }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }

        /* --- UI GENERAL --- */
        .view { display: none; height: 100vh; overflow-y: auto; padding-bottom: 120px; box-sizing: border-box; }
        .view.active { display: block; }
        .aura-logo { font-family: 'Orbitron'; font-size: 1.8rem; letter-spacing: 6px; text-align: center; padding: 30px 0 10px; }

        /* --- ACCESO --- */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 25px; }
        .auth-box { width: 100%; max-width: 340px; text-align: center; }
        .auth-input { width: 100%; background: #0a0a0a; border: 1px solid #1a1a1a; padding: 18px; border-radius: 16px; color: white; margin-bottom: 12px; outline: none; box-sizing: border-box; }

        /* --- HISTORIAS --- */
        .stories-bar { display: flex; padding: 15px 20px; gap: 15px; border-bottom: 1px solid #111; }
        .story-wrapper { position: relative; flex-shrink: 0; cursor: pointer; }
        .my-story-box { width: 75px; height: 75px; border-radius: 20px; background: #111; border: 2px solid #222; overflow: hidden; transition: 0.3s; }
        .story-wrapper.active .my-story-box { border-color: var(--accent); box-shadow: 0 0 10px var(--accent); }
        .add-story-btn { position: absolute; bottom: -2px; right: -2px; width: 22px; height: 22px; background: var(--accent); color: #000; border-radius: 6px; border: 2px solid #000; display: flex; align-items: center; justify-content: center; font-weight: 900; }

        /* --- POSTS --- */
        .post-card { width: 100%; border-bottom: 1px solid #111; margin-bottom: 20px; }
        .post-header { padding: 12px; display: flex; align-items: center; gap: 10px; font-weight: 800; }
        .mini-pfp { width: 30px; height: 30px; border-radius: 8px; background: #222; overflow: hidden; }
        .post-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }
        .post-actions { padding: 12px 15px; display: flex; gap: 20px; font-size: 1.5rem; }

        /* --- COMENTARIOS (SHEET) --- */
        #comment-sheet { position: fixed; bottom: -100%; left: 0; right: 0; height: 60vh; background: var(--glass); border-top: 1px solid #222; border-radius: 30px 30px 0 0; z-index: 9500; transition: 0.4s; padding: 20px; }
        #comment-sheet.active { bottom: 0; }

        /* --- C√ÅMARA --- */
        #camera-screen { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; }
        #camera-video { width: 100%; height: 100%; object-fit: cover; }
        .snap-btn { position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%); width: 80px; height: 80px; border-radius: 50%; border: 5px solid white; background: rgba(255,255,255,0.2); }

        /* --- NAV --- */
        nav { position: fixed; bottom: 25px; left: 20px; right: 20px; height: 75px; background: var(--glass); backdrop-filter: blur(20px); border-radius: 35px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #222; z-index: 5000; }
        .n-btn { font-size: 1.5rem; opacity: 0.3; }
        .n-btn.active { opacity: 1; color: var(--accent); }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div class="auth-box">
            <h1 class="aura-logo">AURA</h1>
            <input type="email" id="acc-email" class="auth-input" placeholder="Tu Email">
            <button onclick="handleAuth()" style="width:100%; padding:18px; border-radius:40px; background:var(--accent); border:none; font-weight:800;">ENTRAR</button>
        </div>
    </div>

    <div id="main-app">
        <div id="view-home" class="view active">
            <div class="aura-logo">AURA</div>
            <div class="stories-bar">
                <div class="story-wrapper" id="story-trigger" onclick="openCamera('story')">
                    <div class="my-story-box"><img id="ui-story" src="" style="display:none; width:100%; height:100%; object-fit:cover;"></div>
                    <div class="add-story-btn">+</div>
                </div>
            </div>
            <div id="feed-posts"></div>
        </div>

        <div id="view-profile" class="view">
            <div style="padding:40px 20px;">
                <div style="display:flex; align-items:center; gap:20px;">
                    <div style="width:80px; height:80px; border-radius:25px; background:#111; border:2px solid var(--accent); overflow:hidden;">
                        <img id="ui-pfp" src="" style="display:none; width:100%; height:100%; object-fit:cover;">
                    </div>
                    <div>
                        <h2 id="ui-name" style="font-family:'Orbitron'; margin:0;">Nombre</h2>
                        <p id="ui-bio" style="color:#666; font-size:0.8rem;">Bio...</p>
                    </div>
                </div>
                <div style="display:flex; gap:10px; margin-top:20px;">
                    <button onclick="document.getElementById('edit-modal').style.display='block'" style="flex:1; background:#111; color:white; border:1px solid #222; padding:10px; border-radius:10px;">Editar</button>
                    <button onclick="alert('Link copiado')" style="flex:1; background:#111; color:white; border:1px solid #222; padding:10px; border-radius:10px;">Compartir</button>
                </div>
            </div>
        </div>

        <nav>
            <div class="n-btn active" onclick="go('home', this)">üè†</div>
            <div class="n-btn" onclick="go('home', this)">üîç</div>
            <div class="n-btn" onclick="openCamera('post')" style="opacity:1; background:white; color:black; width:50px; height:50px; display:flex; align-items:center; justify-content:center; border-radius:50%; font-weight:bold;">+</div>
            <div class="n-btn" onclick="go('home', this)">üé¨</div>
            <div class="n-btn" onclick="go('profile', this)">üë§</div>
        </nav>
    </div>

    <div id="camera-screen">
        <video id="camera-video" autoplay playsinline></video>
        <div class="snap-btn" onclick="capture()"></div>
        <button onclick="closeCamera()" style="position:absolute; top:40px; left:20px; background:none; border:none; color:white; font-size:2rem;">‚úï</button>
        <canvas id="canvas" style="display:none;"></canvas>
    </div>

    <div id="edit-modal" style="display:none; position:fixed; inset:0; background:#000; z-index:9999; padding:40px;">
        <h2 style="font-family:'Orbitron';">EDITAR PERFIL</h2>
        <input type="text" id="in-name" class="auth-input" placeholder="Nuevo Nombre">
        <input type="text" id="in-bio" class="auth-input" placeholder="Nueva Bio">
        <button onclick="saveProfile()" style="width:100%; padding:18px; border-radius:40px; background:white; color:black; border:none; font-weight:800;">GUARDAR</button>
    </div>

    <div id="comment-sheet">
        <div style="display:flex; justify-content:space-between; margin-bottom:20px;"><b>COMENTARIOS</b> <span onclick="document.getElementById('comment-sheet').classList.remove('active')">‚úï</span></div>
        <div id="ui-comments" style="height:70%; overflow-y:auto;"></div>
        <input type="text" id="in-comment" class="auth-input" placeholder="Escribe..." style="margin-top:10px;">
        <button onclick="addComment()" style="background:var(--accent); border:none; width:100%; padding:10px; border-radius:10px; color:black; font-weight:800;">PUBLICAR</button>
    </div>

    <script>
        let user = { email: "", name: "Usuario", bio: "Bio", posts: [], story: null };
        let stream, camTarget, activePost;

        function handleAuth() {
            const em = document.getElementById('acc-email').value;
            if(!em.includes('@')) return;
            user.email = em;
            const saved = localStorage.getItem('aura_full_'+em);
            if(saved) user = JSON.parse(saved);
            else user.name = em.split('@')[0];
            document.getElementById('auth-overlay').style.display='none';
            document.getElementById('main-app').style.display='block';
            render();
        }

        async function openCamera(t) {
            camTarget = t;
            stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
            document.getElementById('camera-video').srcObject = stream;
            document.getElementById('camera-screen').style.display = 'block';
        }

        function closeCamera() {
            if(stream) stream.getTracks().forEach(t => t.stop());
            document.getElementById('camera-screen').style.display = 'none';
        }

        function capture() {
            const v = document.getElementById('camera-video');
            const c = document.getElementById('canvas');
            c.width = v.videoWidth; c.height = v.videoHeight;
            c.getContext('2d').drawImage(v, 0, 0);
            const data = c.toDataURL('image/jpeg');
            if(camTarget === 'story') user.story = data;
            else user.posts.unshift({ src: data, likes: 0, liked: false, comments: [] });
            closeCamera(); save(); render();
        }

        function render() {
            document.getElementById('ui-name').innerText = user.name;
            document.getElementById('ui-bio').innerText = user.bio;
            if(user.story) {
                document.getElementById('ui-story').src = user.story;
                document.getElementById('ui-story').style.display = 'block';
                document.getElementById('story-trigger').classList.add('active');
            }
            const feed = document.getElementById('feed-posts');
            feed.innerHTML = user.posts.map((p, i) => `
                <div class="post-card">
                    <div class="post-header"><b>${user.name}</b></div>
                    <img src="${p.src}" class="post-img" ondblclick="doLike(${i})">
                    <div class="post-actions">
                        <span onclick="doLike(${i})" style="color:${p.liked?'red':'white'}">${p.liked?'‚ù§Ô∏è':'ü§ç'}</span>
                        <span onclick="openComments(${i})">üí¨</span>
                    </div>
                    <div style="padding:0 15px; font-size:0.8rem;"><b>${p.likes} likes</b></div>
                </div>
            `).join('');
        }

        function doLike(i) {
            const p = user.posts[i];
            p.liked ? (p.likes--, p.liked=false) : (p.likes++, p.liked=true);
            save(); render();
        }

        function openComments(i) {
            activePost = i;
            document.getElementById('ui-comments').innerHTML = user.posts[i].comments.map(c => `<div><b>${c.u}:</b> ${c.t}</div>`).join('');
            document.getElementById('comment-sheet').classList.add('active');
        }

        function addComment() {
            const t = document.getElementById('in-comment').value;
            if(!t) return;
            user.posts[activePost].comments.push({ u: user.name, t: t });
            document.getElementById('in-comment').value = "";
            save(); openComments(activePost);
        }

        function saveProfile() {
            user.name = document.getElementById('in-name').value;
            user.bio = document.getElementById('in-bio').value;
            document.getElementById('edit-modal').style.display='none';
            save(); render();
        }

        function go(v, btn) {
            document.querySelectorAll('.view').forEach(x => x.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
        }

        function save() { localStorage.setItem('aura_full_'+user.email, JSON.stringify(user)); }
    </script>
</body>
</html>
