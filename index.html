<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aura | Stories & Live Cam</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;500;800&display=swap');
        :root { --bg: #000; --accent: #00ffd5; --glass: rgba(15,15,15,0.98); }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }

        /* --- UI GENERAL --- */
        .view { display: none; height: 100vh; overflow-y: auto; padding-bottom: 120px; box-sizing: border-box; }
        .view.active { display: block; }
        .aura-logo { font-family: 'Orbitron'; font-size: 1.8rem; letter-spacing: 6px; text-align: center; padding: 30px 0 10px; }

        /* --- ZONA HISTORIAS (SOLICITADO) --- */
        .stories-bar { display: flex; padding: 10px 20px; gap: 15px; overflow-x: auto; border-bottom: 1px solid #111; }
        .story-wrapper { position: relative; flex-shrink: 0; }
        .my-story-box { 
            width: 70px; height: 70px; 
            border-radius: 18px; 
            background: #111; 
            border: 2px solid #222; 
            overflow: hidden; 
            display: flex; align-items: center; justify-content: center;
        }
        .my-story-box img { width: 100%; height: 100%; object-fit: cover; }
        .add-story-btn { 
            position: absolute; bottom: -5px; right: -5px; 
            width: 24px; height: 24px; 
            background: var(--accent); color: #000; 
            border-radius: 8px; border: 3px solid #000;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 14px; cursor: pointer;
        }

        /* --- POSTS --- */
        .post-card { width: 100%; border-bottom: 1px solid #111; margin-bottom: 10px; }
        .post-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; }

        /* --- C√ÅMARA --- */
        #camera-screen { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; }
        #camera-video { width: 100%; height: 100%; object-fit: cover; }
        .cam-ui { position: absolute; bottom: 50px; left: 0; right: 0; display: flex; justify-content: center; align-items: center; }
        .snap-btn { width: 75px; height: 75px; border-radius: 50%; border: 4px solid white; background: rgba(255,255,255,0.2); }

        /* --- NAV --- */
        nav { position: fixed; bottom: 25px; left: 20px; right: 20px; height: 75px; background: var(--glass); backdrop-filter: blur(20px); border-radius: 35px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #222; z-index: 5000; }
        .n-btn { font-size: 1.5rem; opacity: 0.3; }
        .n-btn.active { opacity: 1; color: var(--accent); }
    </style>
</head>
<body>

    <div id="main-app" style="display:block;">
        <div id="view-home" class="view active">
            <div class="aura-logo">AURA</div>
            
            <div class="stories-bar">
                <div class="story-wrapper" onclick="openLiveCamera('story')">
                    <div class="my-story-box" id="story-display">
                        <img id="story-img" src="" style="display:none;">
                        <span id="story-init" style="font-family:'Orbitron'; font-weight:900; color:#333;">?</span>
                    </div>
                    <div class="add-story-btn">+</div>
                </div>
                </div>

            <div id="feed-photos"></div>
        </div>

        <div id="view-video" class="view"></div>
        <div id="view-profile" class="view"></div>

        <nav>
            <div class="n-btn active" onclick="go('home', this)">üè†</div>
            <div class="n-btn" onclick="go('home', this)">üîç</div>
            <div class="n-btn" onclick="openLiveCamera('post')">‚ûï</div>
            <div class="n-btn" onclick="go('video', this)">üé¨</div>
            <div class="n-btn" onclick="go('profile', this)">üë§</div>
        </nav>
    </div>

    <div id="camera-screen">
        <video id="camera-video" autoplay playsinline></video>
        <button onclick="closeLiveCamera()" style="position:absolute; top:40px; left:20px; background:none; border:none; color:white; font-size:2rem;">‚úï</button>
        <div class="cam-ui">
            <div class="snap-btn" onclick="takeSnapshot()"></div>
        </div>
        <canvas id="cam-canvas" style="display:none;"></canvas>
    </div>

    <script>
        let user = { name: "Usuario", posts: [], story: null };
        let stream = null;
        let mode = 'post'; // 'post' o 'story'

        async function openLiveCamera(m) {
            mode = m;
            try {
                stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
                document.getElementById('camera-video').srcObject = stream;
                document.getElementById('camera-screen').style.display = 'block';
            } catch (err) { alert("Error c√°mara"); }
        }

        function closeLiveCamera() {
            if (stream) stream.getTracks().forEach(t => t.stop());
            document.getElementById('camera-screen').style.display = 'none';
        }

        function takeSnapshot() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('cam-canvas');
            canvas.width = video.videoWidth; canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            const data = canvas.toDataURL('image/jpeg');

            if(mode === 'story') {
                user.story = data;
                const img = document.getElementById('story-img');
                img.src = data; img.style.display = 'block';
                document.getElementById('story-init').style.display = 'none';
            } else {
                user.posts.unshift({ src: data });
            }
            
            render();
            closeLiveCamera();
        }

        function render() {
            const feed = document.getElementById('feed-photos');
            feed.innerHTML = user.posts.map(p => `
                <div class="post-card">
                    <div style="padding:12px;"><b>${user.name}</b></div>
                    <img src="${p.src}" class="post-img">
                </div>
            `).join('');
        }

        function go(v, btn) {
            document.querySelectorAll('.view').forEach(x => x.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
        }
    </script>
</body>
</html>
