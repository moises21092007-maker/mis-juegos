<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Aura | Live Camera</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@300;500;800&display=swap');
        :root { --bg: #000; --accent: #00ffd5; --glass: rgba(15,15,15,0.98); }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }

        /* --- LOGIN & APP --- */
        #auth-overlay { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: flex; align-items: center; justify-content: center; }
        #main-app { display: none; height: 100vh; }
        .view { display: none; height: 100vh; overflow-y: auto; padding-bottom: 120px; box-sizing: border-box; }
        .view.active { display: block; }

        /* --- C√ÅMARA EN VIVO (ESTILO TIKTOK) --- */
        #camera-screen { display: none; position: fixed; inset: 0; background: #000; z-index: 9999; }
        #camera-video { width: 100%; height: 100%; object-fit: cover; }
        .cam-ui { position: absolute; bottom: 50px; left: 0; right: 0; display: flex; justify-content: center; align-items: center; gap: 30px; }
        .snap-btn { width: 80px; height: 80px; border-radius: 50%; border: 5px solid white; background: rgba(255,255,255,0.2); cursor: pointer; }
        .close-cam { position: absolute; top: 40px; left: 20px; font-size: 2rem; color: white; border: none; background: none; }

        /* --- FEED & VIDEO ZONE --- */
        .aura-logo { font-family: 'Orbitron'; font-size: 2rem; letter-spacing: 8px; text-align: center; padding: 40px 0 10px; }
        .post-card { width: 100%; border-bottom: 1px solid #111; margin-bottom: 15px; }
        .post-img { width: 100%; aspect-ratio: 1/1; object-fit: cover; background: #050505; }
        .video-item { height: 100vh; scroll-snap-align: start; position: relative; }
        .v-player { width: 100%; height: 100%; object-fit: cover; }

        /* --- NAV --- */
        nav { position: fixed; bottom: 25px; left: 20px; right: 20px; height: 75px; background: var(--glass); backdrop-filter: blur(20px); border-radius: 35px; display: flex; justify-content: space-around; align-items: center; border: 1px solid #222; z-index: 5000; }
        .n-btn { font-size: 1.5rem; opacity: 0.3; }
        .n-btn.active { opacity: 1; color: var(--accent); }
        .n-add { width: 55px; height: 55px; background: #fff; border-radius: 50%; color: #000; display: flex; align-items: center; justify-content: center; font-size: 2rem; transform: translateY(-5px); }
    </style>
</head>
<body>

    <div id="auth-overlay">
        <div style="text-align:center;">
            <h1 style="font-family:'Orbitron'; letter-spacing:10px;">AURA</h1>
            <input type="email" id="acc-email" placeholder="Email" style="padding:15px; border-radius:10px; border:none; width:80%;">
            <br><br>
            <button onclick="handleAuth()" style="padding:15px 40px; border-radius:30px; border:none; background:var(--accent); font-weight:800;">ENTRAR</button>
        </div>
    </div>

    <div id="main-app">
        <div id="view-home" class="view active">
            <div class="aura-logo">AURA</div>
            <div id="feed-photos"></div>
        </div>

        <div id="view-video" class="view" style="padding:0; overflow-y:scroll; scroll-snap-type: y mandatory;">
            <div id="feed-videos"></div>
        </div>

        <div id="view-profile" class="view">
            <div style="padding:40px 20px;">
                <h2 class="u-name" style="font-family:'Orbitron';">Usuario</h2>
                <p>0 Seguidores | 0 Siguiendo</p>
            </div>
        </div>

        <nav>
            <div class="n-btn active" onclick="go('home', this)">üè†</div>
            <div class="n-btn" onclick="go('home', this)">üîç</div>
            <div class="n-add" onclick="openLiveCamera()">+</div>
            <div class="n-btn" onclick="go('video', this)">üé¨</div>
            <div class="n-btn" onclick="go('profile', this)">üë§</div>
        </nav>
    </div>

    <div id="camera-screen">
        <video id="camera-video" autoplay playsinline></video>
        <button class="close-cam" onclick="closeLiveCamera()">‚úï</button>
        <div class="cam-ui">
            <div class="snap-btn" onclick="takeSnapshot()"></div>
        </div>
        <canvas id="cam-canvas" style="display:none;"></canvas>
    </div>

    <script>
        let user = { email: "", name: "Usuario", posts: [], videos: [] };
        let stream = null;

        function handleAuth() {
            const em = document.getElementById('acc-email').value;
            if(!em.includes('@')) return;
            user.email = em;
            const saved = localStorage.getItem('aura_cam_'+em);
            if(saved) user = JSON.parse(saved);
            else user.name = em.split('@')[0];
            localStorage.setItem('aura_session', em);
            document.getElementById('auth-overlay').style.display='none';
            document.getElementById('main-app').style.display='block';
            render();
        }

        // --- FUNCIONES DE C√ÅMARA EN VIVO ---
        async function openLiveCamera() {
            const constraints = { video: { facingMode: "environment" }, audio: false };
            try {
                stream = await navigator.mediaDevices.getUserMedia(constraints);
                document.getElementById('camera-video').srcObject = stream;
                document.getElementById('camera-screen').style.display = 'block';
            } catch (err) {
                alert("No se pudo acceder a la c√°mara. Revisa los permisos.");
            }
        }

        function closeLiveCamera() {
            if (stream) stream.getTracks().forEach(track => track.stop());
            document.getElementById('camera-screen').style.display = 'none';
        }

        function takeSnapshot() {
            const video = document.getElementById('camera-video');
            const canvas = document.getElementById('cam-canvas');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            const photoData = canvas.toDataURL('image/jpeg');
            user.posts.unshift({ src: photoData, likes: 0 });
            
            save(); 
            render();
            closeLiveCamera();
            go('home');
        }

        function go(v, btn) {
            document.querySelectorAll('.view').forEach(x => x.classList.remove('active'));
            document.querySelectorAll('.n-btn').forEach(x => x.classList.remove('active'));
            document.getElementById('view-'+v).classList.add('active');
            if(btn) btn.classList.add('active');
        }

        function render() {
            document.querySelectorAll('.u-name').forEach(el => el.innerText = user.name);
            const fPhotos = document.getElementById('feed-photos');
            fPhotos.innerHTML = user.posts.map(p => `
                <div class="post-card">
                    <div class="post-header" style="padding:10px;"><b>${user.name}</b></div>
                    <img src="${p.src}" class="post-img">
                </div>
            `).join('');
        }

        function save() { localStorage.setItem('aura_cam_'+user.email, JSON.stringify(user)); }

        window.onload = () => {
            const s = localStorage.getItem('aura_session');
            if(s) { user.email = s; const d = localStorage.getItem('aura_cam_'+s); if(d) user = JSON.parse(d); document.getElementById('auth-overlay').style.display='none'; document.getElementById('main-app').style.display='block'; render(); }
        }
    </script>
</body>
</html>
